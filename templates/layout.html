<!DOCTYPE html>
<html lang="{{ session.get('language', 'en') }}" data-theme="light" data-language="{{ session.get('language', 'en') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="server-language" content="{{ session.get('language', 'en') }}">
    <title>{% block title %}Monitoring Dashboard{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">    <!-- Organized CSS imports -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/auth/loading.css') }}">
    {% block head %}{% endblock %}
    <!-- Theme styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes/theme-light.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes/theme-dark.css') }}">
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>    <!-- Language support -->
    <script>
        // Dodajemy globalną zmienną, aby moduły miały dostęp do języka
        window.currentLanguage = "{{ session.get('language', 'en') }}";
        
        // Expose user role and permissions to JavaScript
        {% if session.logged_in %}
        window.userRole = '{{ session.get("user_info", {}).get("role", "viewer") }}';
        window.userPermissions = [{% for permission in session.get('permissions', []) %}'{{ permission }}'{% if not loop.last %}, {% endif %}{% endfor %}];
        {% else %}
        window.userRole = 'guest';
        window.userPermissions = [];
        {% endif %}
    </script>
    <script src="{{ url_for('static', filename='js/localization/language.js') }}"></script>
</head>
<body class="with-sidebar">
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-brand">
            <i class="fas fa-chart-line"></i>
            <span class="brand-text" data-en="Monitoring System" data-pl="System Monitoringu">Monitoring System</span>
        </div>
        {% if session.logged_in %}
        <div class="nav-items">
            <button id="theme-toggle" class="theme-toggle" title="Toggle theme">
                <i class="fas fa-sun"></i>
            </button>            <button id="language-toggle" class="language-toggle" title="Change language">
                <i class="fas fa-language"></i>
                <span>{{ session.get('language', 'EN').upper() }}</span>            </button>
            {% if session.logged_in %}
            <a href="{{ url_for('profile') }}" class="user-info">
                {% if session.user_info and session.user_info.avatar_path %}
                    <img src="{{ url_for('static', filename='avatars/' + session.user_info.avatar_path) }}?v={{ time.time() }}" alt="Profile" class="nav-avatar">
                {% else %}
                    <div class="nav-avatar-placeholder">
                        <i class="fas fa-user-circle"></i>
                    </div>
                {% endif %}
                <span class="nav-username">{{ session.user_info.display_name if session.user_info.display_name else session.username }}</span>
            </a>
            {% endif %}
            <a href="{{ url_for('logout') }}" class="logout-button">
                <i class="fas fa-sign-out-alt"></i>
                <span data-en="Logout" data-pl="Wyloguj">Logout</span>
            </a>
        </div>
        {% endif %}
    </nav>

    <!-- Side Navigation -->
    <nav class="side-nav">
        <div class="nav-section">
            <h3 data-en="Main Menu" data-pl="Menu Główne">Main Menu</h3>
            <a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">
                <i class="fas fa-home"></i> <span data-en="Dashboard" data-pl="Pulpit">Dashboard</span>
            </a>
        </div>
        
        <div class="nav-section">
            <h3>Zabbix</h3>
            <a href="/available-hosts" class="nav-link available {% if request.path == '/available-hosts' %}active{% endif %}">
                <i class="fas fa-check-circle"></i> <span data-en="Available" data-pl="Dostępne">Available</span>
            </a>
            <a href="/unavailable-hosts" class="nav-link unavailable {% if request.path == '/unavailable-hosts' %}active{% endif %}">
                <i class="fas fa-times-circle"></i> <span data-en="Unavailable" data-pl="Niedostępne">Unavailable</span>
            </a>
            <a href="/unknown-hosts" class="nav-link unknown {% if request.path == '/unknown-hosts' %}active{% endif %}">
                <i class="fas fa-question-circle"></i> <span data-en="Unknown" data-pl="Nieznane">Unknown</span>
            </a>
        </div>
        
        <div class="nav-section">
            <h3 data-en="Tools" data-pl="Narzędzia">Tools</h3>
            <a href="/reports" class="nav-link {% if request.path == '/reports' %}active{% endif %}">
                <i class="fas fa-file-alt"></i> <span data-en="Reports" data-pl="Raporty">Reports</span>
            </a>
        </div>        <div class="nav-section">
            <h3 data-en="Functions" data-pl="Funkcje">Functions</h3>
            {% if session.role != 'viewer' %}
            <a href="/inventory" class="nav-link {% if request.path == '/inventory' %}active{% endif %}">
                <i class="fas fa-boxes"></i> <span data-en="Item Inventory" data-pl="Inwentaryzacja">Item Inventory</span>
            </a>
            {% endif %}
            <a href="/tasks" class="nav-link {% if request.path == '/tasks' %}active{% endif %}">
                <i class="fas fa-tasks"></i> <span data-en="Task Management" data-pl="Zarządzanie zadaniami">Task Management</span>
            </a>
        </div>

        <div class="nav-section">
            <h3 data-en="GLPI Inventory" data-pl="Inwentaryzacja GLPI">GLPI Inventory</h3>
            <a href="/glpi/workstations" class="nav-link {% if request.path == '/glpi/workstations' %}active{% endif %}">
                <i class="fas fa-desktop"></i> <span data-en="Workstations (KS)" data-pl="Stacje robocze (KS)">Workstations (KS)</span>
            </a>
            <a href="/glpi/terminals" class="nav-link {% if request.path == '/glpi/terminals' %}active{% endif %}">
                <i class="fas fa-terminal"></i> <span data-en="Terminals (KT)" data-pl="Terminale (KT)">Terminals (KT)</span>
            </a>
            <a href="/glpi/servers" class="nav-link {% if request.path == '/glpi/servers' %}active{% endif %}">
                <i class="fas fa-server"></i> <span data-en="Servers" data-pl="Serwery">Servers</span>
            </a>
            <a href="/glpi/network" class="nav-link {% if request.path == '/glpi/network' %}active{% endif %}">
                <i class="fas fa-network-wired"></i> <span data-en="Network Devices" data-pl="Urządzenia sieciowe">Network Devices</span>
            </a>
            <a href="/glpi/printers" class="nav-link {% if request.path == '/glpi/printers' %}active{% endif %}">
                <i class="fas fa-print"></i> <span data-en="Printers" data-pl="Drukarki">Printers</span>
            </a>
            <a href="/glpi/monitors" class="nav-link {% if request.path == '/glpi/monitors' %}active{% endif %}">
                <i class="fas fa-tv"></i> <span data-en="Monitors" data-pl="Monitory">Monitors</span>
            </a>
            <a href="/glpi/racks" class="nav-link {% if request.path == '/glpi/racks' %}active{% endif %}">
                <i class="fas fa-server"></i> <span data-en="Racks" data-pl="Szafy serwerowe">Racks</span>
            </a>
            <a href="/glpi/others" class="nav-link {% if request.path == '/glpi/others' %}active{% endif %}">
                <i class="fas fa-microchip"></i> <span data-en="Other Devices" data-pl="Inne urządzenia">Other Devices</span>
            </a>        </div>

        {% if has_permission('view_logs') %}
        <div class="nav-section">
            <h3>Graylog</h3>
            <a href="/graylog/logs?refresh=1" class="nav-link {% if request.path == '/graylog/logs' %}active{% endif %}">
                <i class="fas fa-history"></i> <span data-en="Recent Logs" data-pl="Ostatnie logi">Recent Logs</span>
            </a>
            <a href="/graylog/loading?target=/graylog/messages-over-time" class="nav-link {% if request.path == '/graylog/messages-over-time' %}active{% endif %}">
                <i class="fas fa-chart-line"></i> <span data-en="Messages Over Time" data-pl="Wiadomości w czasie">Messages Over Time</span>
            </a>
        </div>
        {% endif %}        {% if has_permission('manage_users') %}
        <div class="nav-section">
            <h3 data-en="Administration" data-pl="Administracja">Administration</h3>
            <a href="/unified_management" class="nav-link {% if request.path == '/unified_management' %}active{% endif %}">
                <i class="fas fa-users-cog"></i> <span data-en="User & Role Management" data-pl="Zarządzanie użytkownikami i rolami">User & Role Management</span>
            </a>
        </div>
        {% endif %}
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4 data-en="Monitoring System" data-pl="System Monitoringu">Monitoring System</h4>
                <p>Version 1.0.0</p>
            </div>
            <div class="footer-section">
                <h4 data-en="Quick Links" data-pl="Szybkie linki">Quick Links</h4>
                <a href="#" data-en="Documentation" data-pl="Dokumentacja">Documentation</a>
                <a href="#" data-en="Support" data-pl="Wsparcie">Support</a>
            </div>
            <div class="footer-section">
                <h4 data-en="Contact" data-pl="Kontakt">Contact</h4>
                <p>bartosz.dutka82@student.pk.edu.pl</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-en="&copy; 2025 Monitoring System. All rights reserved." data-pl="&copy; 2025 System Monitoringu. Wszelkie prawa zastrzeżone.">&copy; 2024 Monitoring System. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
document.addEventListener('DOMContentLoaded', () => {
    const themeToggle = document.getElementById('theme-toggle');
    const icon = themeToggle.querySelector('i');
    const html = document.documentElement;
    
    // Funkcja do aktualizacji motywu
    function updateTheme(isDark) {
        const theme = isDark ? 'dark' : 'light';
        html.setAttribute('data-theme', theme);
        document.body.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        // Aktualizuj ikonę
        icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        icon.style.color = isDark ? '#e0e0e0' : '#2ecc71';
        
        // Wymuś przeliczenie stylów
        document.body.style.display = 'none';
        document.body.offsetHeight; // Force reflow
        document.body.style.display = '';
    }
    
    // Inicjalizacja przy załadowaniu
    const savedTheme = localStorage.getItem('theme') || 'light';
    updateTheme(savedTheme === 'dark');
    
    // Obsługa kliknięcia
    themeToggle.addEventListener('click', () => {
        const isDark = html.getAttribute('data-theme') === 'dark';
        updateTheme(!isDark);
    });
});
</script>
</body>
</html>